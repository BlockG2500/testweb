<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>replit</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <input id="discordname" />
  <input id=email />
  <input id=ID />
  Hello world
  <script src="script.js">
    function login() {
  const CLIENT_ID = 'YOUR_CLIENT_ID';
  const REDIRECT_URI = 'YOUR_REDIRECT_URI';
  const SCOPE = 'identify email';

  const authUrl = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=code&scope=${SCOPE}`;

  window.location.href = authUrl;
}

function fetchUserProfile(code) {
  const CLIENT_ID = 'YOUR_CLIENT_ID';
  const CLIENT_SECRET = 'YOUR_CLIENT_SECRET';
  const REDIRECT_URI = 'YOUR_REDIRECT_URI';

  const tokenUrl = 'https://discord.com/api/oauth2/token';
  const userProfileUrl = 'https://discord.com/api/users/@me';

  const data = new URLSearchParams();
  data.append('client_id', CLIENT_ID);
  data.append('client_secret', CLIENT_SECRET);
  data.append('grant_type', 'authorization_code');
  data.append('code', code);
  data.append('redirect_uri', REDIRECT_URI);
  data.append('scope', SCOPE);

  fetch(tokenUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: data
  })
  .then(response => response.json())
  .then(tokenData => {
    const accessToken = tokenData.access_token;

    fetch(userProfileUrl, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    })
    .then(response => response.json())
    .then(user => {
      const discordName = user.username;
      const discordId = user.id;
      const discordEmail = user.email;
      console.log(user);
    })
    .catch(error => {
      alert("fetch error:" + error)
      console.error('Error fetching user profile:', error);
    });
  })
  .catch(error => {
    alert("access or code error:" + error)
    console.error('Error exchanging authorization code for access token:', error);
  });
}

// Check if the code exists in local storage
const storedCode = localStorage.getItem('discordCode');

if (storedCode) {
  fetchUserProfile(storedCode);
} else {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');

  if (code) {
    // Save the code to local storage
    localStorage.setItem('discordCode', code);

    // Remove the code from the URL
    const newUrl = window.location.href.replace(`?code=${code}`, '');
    window.history.replaceState({}, document.title, newUrl);

    fetchUserProfile(code);
  }
}

  </script>

  <!--
  This script places a badge on your repl's full-browser view back to your repl's cover
  page. Try various colors for the theme: dark, light, red, orange, yellow, lime, green,
  teal, blue, blurple, magenta, pink!
  -->
  <script src="https://replit.com/public/js/replit-badge-v2.js" theme="dark" position="bottom-right"></script>
</body>

</html>